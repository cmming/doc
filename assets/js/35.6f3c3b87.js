(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{358:function(a,t,s){"use strict";s.r(t);var e=s(18),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"docker-镜像构建最佳实践指南"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像构建最佳实践指南"}},[a._v("#")]),a._v(" Docker 镜像构建最佳实践指南")]),a._v(" "),t("p",[a._v("本文档介绍了 Docker 镜像构建的最佳实践，重点关注多平台构建和镜像优化技术。")]),a._v(" "),t("h2",{attrs:{id:"目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[a._v("#")]),a._v(" 目录")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#%E5%A4%9A%E5%B9%B3%E5%8F%B0%E6%9E%84%E5%BB%BA"}},[a._v("多平台构建")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#dockerfile-%E4%BC%98%E5%8C%96%E7%A4%BA%E4%BE%8B"}},[a._v("Dockerfile 优化示例")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E6%9E%84%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83"}},[a._v("构建和发布")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E8%BF%90%E8%A1%8C%E5%92%8C%E6%B5%8B%E8%AF%95"}},[a._v("运行和测试")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"}},[a._v("故障排除")])])]),a._v(" "),t("h2",{attrs:{id:"多平台构建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多平台构建"}},[a._v("#")]),a._v(" 多平台构建")]),a._v(" "),t("h3",{attrs:{id:"_1-启用-docker-buildx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-启用-docker-buildx"}},[a._v("#")]),a._v(" 1. 启用 Docker Buildx")]),a._v(" "),t("p",[a._v("Docker Buildx 是 Docker 的扩展构建功能，支持多平台镜像构建。")]),a._v(" "),t("h4",{attrs:{id:"_1-1-准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-准备工作"}},[a._v("#")]),a._v(" 1.1 准备工作")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启用多架构支持（需要特权模式）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--privileged")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" tonistiigi/binfmt "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--install")]),a._v(" all\n")])])]),t("h4",{attrs:{id:"_1-2-创建构建器实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-创建构建器实例"}},[a._v("#")]),a._v(" 1.2 创建构建器实例")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建并使用新的构建器实例（支持代理配置）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" buildx create "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" devbuilder "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--driver")]),a._v(" docker-container "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  --driver-opt "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("env.http_proxy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://192.168.0.159:7890 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  --driver-opt "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("env.https_proxy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://192.168.0.159:7890 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--use")]),a._v("\n")])])]),t("h4",{attrs:{id:"_1-3-验证构建器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-验证构建器"}},[a._v("#")]),a._v(" 1.3 验证构建器")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动构建器并检查配置")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" buildx inspect "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--bootstrap")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 验证支持的平台")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" buildx "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n")])])]),t("h2",{attrs:{id:"dockerfile-优化示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-优化示例"}},[a._v("#")]),a._v(" Dockerfile 优化示例")]),a._v(" "),t("p",[a._v("以下 Dockerfile 展示了多平台构建的最佳实践，包括镜像大小优化、多阶段构建参数使用等。")]),a._v(" "),t("h3",{attrs:{id:"_2-1-基础镜像和构建参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-基础镜像和构建参数"}},[a._v("#")]),a._v(" 2.1 基础镜像和构建参数")]),a._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" almalinux:8")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 多平台构建参数（必须在每个阶段内声明）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ARG")]),a._v(" TARGETPLATFORM")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ARG")]),a._v(" TARGETARCH")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ARG")]),a._v(" BUILDPLATFORM")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示构建信息（便于调试）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" set -ex; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    echo "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Building on: ${BUILDPLATFORM:-unknown}"')]),a._v("; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    echo "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Target platform: ${TARGETPLATFORM:-unknown}/${TARGETARCH:-unknown}"')]),a._v("; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    echo "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Architecture: $(uname -m)"')])]),a._v("\n")])])]),t("h3",{attrs:{id:"_2-2-包管理器优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-包管理器优化"}},[a._v("#")]),a._v(" 2.2 包管理器优化")]),a._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# DNF 配置优化：提升下载速度，减少镜像大小")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" set -eux; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    echo -e "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"fastestmirror=True\\nmax_parallel_downloads=10\\ntsflags=nodocs\\ninstall_weak_deps=False"')]),a._v(" >> /etc/dnf/dnf.conf; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    dnf -y install dnf-plugins-core epel-release; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启用 PowerTools 仓库（某些包依赖）")]),a._v("\n    dnf config-manager --set-enabled powertools || true; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    dnf -y update;")]),a._v("\n")])])]),t("h3",{attrs:{id:"_2-3-依赖安装和清理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-依赖安装和清理"}},[a._v("#")]),a._v(" 2.3 依赖安装和清理")]),a._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 分层安装：基础工具")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" dnf -y install --setopt=tsflags=nodocs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n        curl wget tar ca-certificates fontconfig; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Java 运行环境")]),a._v("\n    dnf -y install --setopt=tsflags=nodocs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n        java-1.8.0-openjdk java-1.8.0-openjdk-devel; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# LibreOffice 办公套件（无头模式）")]),a._v("\n    dnf -y install --setopt=tsflags=nodocs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n        libreoffice-headless libreoffice-writer; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 语言包")]),a._v("\n    dnf -y install --setopt=tsflags=nodocs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n        glibc-langpack-zh glibc-langpack-en;")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 字体安装（支持中日韩文字显示）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" dnf -y install --setopt=tsflags=nodocs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n        dejavu-fonts-common dejavu-sans-fonts dejavu-serif-fonts dejavu-sans-mono-fonts "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n        google-noto-sans-cjk-ttc-fonts google-noto-serif-cjk-ttc-fonts "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n        wqy-microhei-fonts || true; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 可选字体（可能在某些仓库中不可用）")]),a._v("\n    dnf -y install --setopt=tsflags=nodocs wqy-zenhei-fonts || "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n        echo "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"wqy-zenhei-fonts not found, skipping"')]),a._v("; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 刷新字体缓存")]),a._v("\n    fc-cache -fv; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 验证安装")]),a._v("\n    java -version; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    libreoffice --version || true; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 清理缓存")]),a._v("\n    dnf clean all; "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    rm -rf /var/cache/dnf/* /tmp/* /var/tmp/*")]),a._v("\n")])])]),t("h3",{attrs:{id:"_2-4-环境变量配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-环境变量配置"}},[a._v("#")]),a._v(" 2.4 环境变量配置")]),a._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 语言环境和 Java 路径")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENV")]),a._v(" LANG=zh_CN.UTF-8 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    LC_ALL=zh_CN.UTF-8 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    LANGUAGE=zh_CN:zh "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    LC_CTYPE=zh_CN.UTF-8 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("\\")]),a._v("\n    JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENV")]),a._v(" PATH="),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"$JAVA_HOME/bin:${PATH}"')])]),a._v("\n")])])]),t("h2",{attrs:{id:"构建和发布"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建和发布"}},[a._v("#")]),a._v(" 构建和发布")]),a._v(" "),t("h3",{attrs:{id:"_3-1-构建多平台镜像并推送"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-构建多平台镜像并推送"}},[a._v("#")]),a._v(" 3.1 构建多平台镜像并推送")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 同时构建 AMD64 和 ARM64 架构，并推送到 Docker Hub")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" buildx build "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--file")]),a._v(" Dockerfile.cm "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--platform")]),a._v(" linux/amd64,linux/arm64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tag")]),a._v(" chmi0427/myapp:latest "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--push")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),t("h3",{attrs:{id:"_3-2-构建单平台镜像-离线部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-构建单平台镜像-离线部署"}},[a._v("#")]),a._v(" 3.2 构建单平台镜像（离线部署）")]),a._v(" "),t("p",[a._v("当需要在特定环境中离线部署时，可以构建单平台镜像并导出为 tar 文件。")]),a._v(" "),t("h4",{attrs:{id:"arm64-架构镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#arm64-架构镜像"}},[a._v("#")]),a._v(" ARM64 架构镜像")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" buildx build "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--platform")]),a._v(" linux/arm64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--file")]),a._v(" Dockerfile "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tag")]),a._v(" linux8-jdk8-libreoffice:arm64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--output")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("docker,dest"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./linux8-jdk8-libreoffice-arm64.tar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),t("h4",{attrs:{id:"amd64-架构镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#amd64-架构镜像"}},[a._v("#")]),a._v(" AMD64 架构镜像")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" buildx build "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--platform")]),a._v(" linux/amd64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--file")]),a._v(" Dockerfile "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--tag")]),a._v(" linux8-jdk8-libreoffice:amd64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--output")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("docker,dest"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("./linux8-jdk8-libreoffice-amd64.tar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),t("h3",{attrs:{id:"_3-3-导入离线镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-导入离线镜像"}},[a._v("#")]),a._v(" 3.3 导入离线镜像")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导入 ARM64 镜像")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" load "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" linux8-jdk8-libreoffice-arm64.tar\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导入 AMD64 镜像")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" load "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" linux8-jdk8-libreoffice-amd64.tar\n")])])]),t("h2",{attrs:{id:"运行和测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行和测试"}},[a._v("#")]),a._v(" 运行和测试")]),a._v(" "),t("h3",{attrs:{id:"_4-1-功能测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-功能测试"}},[a._v("#")]),a._v(" 4.1 功能测试")]),a._v(" "),t("p",[a._v("以下命令演示如何运行镜像并测试 LibreOffice 文档转换功能。")]),a._v(" "),t("h4",{attrs:{id:"测试-arm64-镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-arm64-镜像"}},[a._v("#")]),a._v(" 测试 ARM64 镜像")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--platform")]),a._v(" linux/arm64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("/:/workspace "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    linux8-jdk8-libreoffice:arm64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("\"\n        # 转换 Word 文档为 PDF\n        libreoffice --headless --convert-to pdf --outdir /workspace /workspace/test.docx\n        \n        echo '=== 转换完成 ==='\n        echo '平台架构: '"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n        echo 'Java 版本: '\n        java -version 2>&1 | head -1\n        echo 'LibreOffice 版本: '\n        libreoffice --version 2>/dev/null || echo 'LibreOffice 检测失败'\n        echo '输出文件: '\n        ls -la /workspace/*.pdf 2>/dev/null || echo '未找到 PDF 文件'\n    \"")]),a._v("\n")])])]),t("h4",{attrs:{id:"测试-amd64-镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试-amd64-镜像"}},[a._v("#")]),a._v(" 测试 AMD64 镜像")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--platform")]),a._v(" linux/amd64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("/:/workspace "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    linux8-jdk8-libreoffice:amd64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("\"\n        # 转换 Word 文档为 PDF\n        libreoffice --headless --convert-to pdf --outdir /workspace /workspace/test.docx\n        \n        echo '=== 转换完成 ==='\n        echo '平台架构: '"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n        echo 'Java 版本: '\n        java -version 2>&1 | head -1\n        echo 'LibreOffice 版本: '\n        libreoffice --version 2>/dev/null || echo 'LibreOffice 检测失败'\n        echo '输出文件: '\n        ls -la /workspace/*.pdf 2>/dev/null || echo '未找到 PDF 文件'\n    \"")]),a._v("\n")])])]),t("h3",{attrs:{id:"_4-2-交互式调试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-交互式调试"}},[a._v("#")]),a._v(" 4.2 交互式调试")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入容器进行交互式调试")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("/:/workspace "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    linux8-jdk8-libreoffice:arm64 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 在容器内手动测试各项功能")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查字体安装")]),a._v("\nfc-list "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" noto\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查 Java 环境")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("which")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 测试 LibreOffice")]),a._v("\nlibreoffice "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--help")]),a._v("\n")])])]),t("h2",{attrs:{id:"故障排除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#故障排除"}},[a._v("#")]),a._v(" 故障排除")]),a._v(" "),t("h3",{attrs:{id:"_5-1-常见问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-常见问题"}},[a._v("#")]),a._v(" 5.1 常见问题")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("问题")]),a._v(" "),t("th",[a._v("原因")]),a._v(" "),t("th",[a._v("解决方案")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("构建失败：平台不支持")]),a._v(" "),t("td",[a._v("Docker Buildx 未正确配置")]),a._v(" "),t("td",[a._v("重新运行 "),t("code",[a._v("tonistiigi/binfmt")]),a._v(" 和 "),t("code",[a._v("buildx create")])])]),a._v(" "),t("tr",[t("td",[a._v("字体显示异常")]),a._v(" "),t("td",[a._v("中文字体未安装")]),a._v(" "),t("td",[a._v("检查 "),t("code",[a._v("google-noto-sans-cjk-ttc-fonts")]),a._v(" 是否安装成功")])]),a._v(" "),t("tr",[t("td",[a._v("LibreOffice 转换失败")]),a._v(" "),t("td",[a._v("无头模式配置问题")]),a._v(" "),t("td",[a._v("确保使用 "),t("code",[a._v("--headless")]),a._v(" 参数")])]),a._v(" "),t("tr",[t("td",[a._v("网络连接超时")]),a._v(" "),t("td",[a._v("代理配置问题")]),a._v(" "),t("td",[a._v("检查构建器的代理设置")])])])]),a._v(" "),t("h3",{attrs:{id:"_5-2-调试命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-调试命令"}},[a._v("#")]),a._v(" 5.2 调试命令")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查构建器状态")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" buildx "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看详细构建日志")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" buildx build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--progress")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("plain "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检查镜像信息")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" buildx imagetools inspect chmi0427/myapp:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看镜像层信息")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("history")]),a._v(" linux8-jdk8-libreoffice:arm64\n")])])]),t("h3",{attrs:{id:"_5-3-性能优化建议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-性能优化建议"}},[a._v("#")]),a._v(" 5.3 性能优化建议")]),a._v(" "),t("ol",[t("li",[t("strong",[a._v("缓存优化")]),a._v("：将不经常变化的依赖安装放在前面的层")]),a._v(" "),t("li",[t("strong",[a._v("镜像大小")]),a._v("：使用 "),t("code",[a._v(".dockerignore")]),a._v(" 排除不必要的文件")]),a._v(" "),t("li",[t("strong",[a._v("并行构建")]),a._v("：利用 Buildx 的并行构建能力")]),a._v(" "),t("li",[t("strong",[a._v("多阶段构建")]),a._v("：对于复杂应用，考虑使用多阶段构建减少最终镜像大小")])]),a._v(" "),t("hr"),a._v(" "),t("h2",{attrs:{id:"相关资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相关资源"}},[a._v("#")]),a._v(" 相关资源")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/buildx/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Docker Buildx 官方文档"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/desktop/multi-arch/",target:"_blank",rel:"noopener noreferrer"}},[a._v("多架构镜像构建指南"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://wiki.almalinux.org/documentation/",target:"_blank",rel:"noopener noreferrer"}},[a._v("AlmaLinux 包管理器优化"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);